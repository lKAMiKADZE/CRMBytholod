@model CRMBytholod.ViewModels.OrdersVM

@{
    ViewData["Title"] = "Заявки";
    //Layout = "_LayoutFindText";
}

<h1>Заказы</h1>

<p>
    <a asp-action="CreateOrder"><input type="button" class="btn btn-primary" value="Новый заказ" /> </a>
</p>

<hr />

@* Фильтр по заявкам *@



<div>

    <form asp-action="Orders" method="get" id="form">
        <input hidden asp-for="Page" value="@Model.Page" />
        <input hidden asp-for="Step" value="@Model.Step" />

        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="filtrOrders.Adres" class="control-label">Улица</label>
                    <input asp-for="filtrOrders.Adres" class="form-control" autocomplete="off"/>

                    <input type="hidden" id="hfCustomer" name="CustomerId" />
                </div>

                
                <div class="form-group">
                    <label>Статус заказа</label>
                    <select asp-for="filtrOrders.ID_STATUS" class="form-control">
                        <option value="0">Все</option>
                        <option value="1">В ОЖИДАНИИ</option>
                        <option value="4">В РАБОТЕ</option>
                        <option value="2">ПОВТОР</option>
                        <option value="5">ВЫПОЛНЕН</option>
                        <option value="3">ОТКАЗ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="control-label">Выбрать мастера</label>
                    <select asp-for="filtrOrders.Master.ID_USER" class="form-control">
                        <option value="4">—</option>
                        @foreach (var item in Model.MASTERs)
                        {
                            <option value="@item.ID_USER">@item.Name</option>
                        }
                    </select>
                </div>


            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="inputDate">Дата закрытия С:</label>
                    <input type="date" asp-for="filtrOrders.DateStart" class="form-control">
                </div>
                <div class="form-group">
                    <label for="inputDate">Дата закрытия ПО:</label>
                    <input type="date" asp-for="filtrOrders.DateEnd" class="form-control">
                </div>
                <div class="form-group">
                    <label for="inputDate">По конкретной дате</label>
                    <input type="date" asp-for="filtrOrders.DateOne" class="form-control">
                </div>

            </div>

            <div class="col-md-2">
                <div class="form-group">
                    <label asp-for="filtrOrders.Msisdn" class="control-label">Номер телефона</label>
                    <input asp-for="filtrOrders.Msisdn" class="form-control" autocomplete="off" />
                </div>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input chekboxLarge" asp-for="filtrOrders.Povtor" >
                    <label class="form-check-label">Повторный заказ</label>
                </div>
                <br />

                <input class="btn btn-secondary" type="submit" value="Поиск" />
                <br /><br />
                <a asp-action="Orders"><input type="button" class="btn btn-info " value="Сбросить фильтр" /> </a>
            </div>
        </div>
    </form>

    <hr />

    <div class="row">
        <div class="col-md-5">
            <nav aria-label="Page navigation example">
                <ul class="pagination">
                    <li class="page-item">
                        <a class="page-link" href='@Url.Action("Orders", "Home", new { page=1, step=Model.Step,
                                                                    adres=Model.filtrOrders.Adres, dateStart=Model.filtrOrders.DateStart,
                                                                    dateEnd=Model.filtrOrders.DateEnd, povtor=Model.filtrOrders.Povtor,
                                                                    id_status=Model.filtrOrders.ID_STATUS   }, null)'>В Начало</a>
                    </li>
                    @if (Model.Page > 1)
                    {
                        <li>
                            <a class="page-link" href='@Url.Action("Orders", "Home", new { page=Model.Page-1, step=Model.Step,
                                                                    adres=Model.filtrOrders.Adres, dateStart=Model.filtrOrders.DateStart,
                                                                    dateEnd=Model.filtrOrders.DateEnd, povtor=Model.filtrOrders.Povtor,
                                                                    id_status=Model.filtrOrders.ID_STATUS   }, null)'> Назад </a>
                        </li>
                    }
                    <li class="page-item"><b><a class="page-link" href="#">@Model.Page</a></b></li>

                    <li class="page-item">
                        <a class="page-link" href='@Url.Action("Orders", "Home", new { page=Model.Page+1, step=Model.Step,
                                                                    adres=Model.filtrOrders.Adres, dateStart=Model.filtrOrders.DateStart,
                                                                    dateEnd=Model.filtrOrders.DateEnd, povtor=Model.filtrOrders.Povtor,
                                                                    id_status=Model.filtrOrders.ID_STATUS   }, null)'>Вперед</a>
                    </li>


                </ul>
            </nav>
        </div>
        <div class="col-md-3 col-md-offset-3">
            <nav aria-label="Page navigation example">
                <ul class="pagination">
                    @for (int i = 0; i < Model.Steps.Length; i++)
                    {
                        if (Model.Step == Model.Steps[i])//текущий выбранный параметр выделяется жирным
                        {
                            <li class="page-item">
                                <a class="page-link" href='@Url.Action("Orders", "Home", new { page = Model.Page, step = Model.Steps[i],
                                                                    adres=Model.filtrOrders.Adres, dateStart=Model.filtrOrders.DateStart,
                                                                    dateEnd=Model.filtrOrders.DateEnd, povtor=Model.filtrOrders.Povtor,
                                                                    id_status=Model.filtrOrders.ID_STATUS    }, null)'><b>@Model.Steps[i]</b></a>
                                                                </li>
                                                            }
                                                            else
                                                            {
                                                                <li class="page-item">
                                                                    <a class="page-link" href='@Url.Action("Orders", "Home", new {  page = Model.Page, step = Model.Steps[i],
                                                                    adres=Model.filtrOrders.Adres, dateStart=Model.filtrOrders.DateStart,
                                                                    dateEnd=Model.filtrOrders.DateEnd, povtor=Model.filtrOrders.Povtor,
                                                                    id_status=Model.filtrOrders.ID_STATUS   }, null)'>@Model.Steps[i]</a>
                                                                </li>
                                                            }
                                                        }
                </ul>
            </nav>
        </div>


    </div>

</div>


@* Вывод заявок *@
<table class="table">
    <thead>
        <tr>
            <th>
                ID
            </th>
            <th>
                Дата
            </th>
            <th >
                Адрес
            </th>
            <th>
                Номер
            </th>
            <th>
                Холодильник дефект
            </th>
            <th>
                Время
            </th>
            <th>
                Мастер
            </th>
            <th width="165">
                Статус
            </th>
            <th>
                Промокод
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Orders)
        {
            <tr>
                <td>
                    <a asp-action="DetailOrder" asp-route-id_zakaz="@item.ID_ZAKAZ"><b>@item.ID_ZAKAZ</b></a>
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.GetDATA)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.GetAdresFull)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Msisdn1)
                </td>
                <td>
                    <a asp-action="DetailOrder" asp-route-id_zakaz="@item.ID_ZAKAZ"><b>@item.HOLODILNIK_DEFECT</b></a>
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.VREMJA)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.USER_MASTER.Name)
                </td>
                <td>
                    @switch (item.STATUS.NameStatus)
                    {
                        case "В ОЖИДАНИИ":<span class="label" style='background-color:@item.STATUS.ColorHex; padding: 6px;'>@item.STATUS.NameStatus</span> break;
                    case "ПОВТОР": <span class="label" style='background-color:@item.STATUS.ColorHex; padding: 6px;'>@item.STATUS.NameStatus</span> break;
                case "ОТКАЗ": <span class="label" style='background-color:@item.STATUS.ColorHex; padding: 6px;'>@item.STATUS.NameStatus</span> break;
            case "В РАБОТЕ": <span class="label" style='background-color:@item.STATUS.ColorHex; padding: 6px;'>@item.STATUS.NameStatus</span> break;
        case "ВЫПОЛНЕН": <span class="label" style='background-color:@item.STATUS.ColorHex; padding: 6px;'>@item.STATUS.NameStatus</span> break;
    default: @item.STATUS.NameStatus; break;
}

                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Promocode)
                </td>
            </tr>
        }
    </tbody>
</table>
